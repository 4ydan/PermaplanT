pipeline {
    agent { label 'permaplant' }

    stages {
        stage('Build') {
            steps {
                echo 'Building...'
                sh './ci/build-scripts/build-backend.sh'
                sh './ci/build-scripts/build-frontend.sh'
                stash includes: 'backend/target/release/backend', name: 'backend'
                stash includes: 'frontend/dist', name: 'frontend'
            }
        }

        stage('Deploy to Dev') {
            when {
                branch "master"
            }

            steps {
                echo 'Deploying to Dev ...'
                unstash 'backend'
                unstash 'frontend'
            }
        }
    }
}
